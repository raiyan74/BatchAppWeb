<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoGo Web - Image Batch Processor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .position-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        .position-button {
            padding: 10px;
            text-align: center;
            background-color: #ecf0f1;
            border: 2px solid #bdc3c7;
            border-radius: 4px;
            cursor: pointer;
        }
        .position-button.selected {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }
        .slider-container {
            margin-top: 10px;
        }
        .preview-container {
            margin-top: 20px;
            text-align: center;
        }
        #preview-canvas {
            max-width: 100%;
            border: 1px solid #ddd;
            display: none;
        }
        #process-button {
            background-color: #27ae60;
            padding: 12px 20px;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
        }
        #process-button:hover {
            background-color: #2ecc71;
        }
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        progress {
            width: 100%;
            height: 25px;
        }
        #gallery {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        .result-image {
            width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            cursor: pointer;
        }
        .file-input-container input[type="file"] {
            position: absolute;
            font-size: 100px;
            right: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AutoGo Web - Image Batch Processor</h1>
        
        <div class="section">
            <div class="section-title">1. Select Images to Process</div>
            <div class="input-group">
                <div class="file-input-container">
                    <button type="button">Choose Images (JPG/JPEG)</button>
                    <input type="file" id="image-input" accept=".jpg,.jpeg" multiple>
                </div>
                <div id="image-count" style="margin-top: 10px;"></div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">2. Select Logo</div>
            <div class="input-group">
                <div class="file-input-container">
                    <button type="button">Choose Logo (PNG)</button>
                    <input type="file" id="logo-input" accept=".png">
                </div>
                <div id="logo-name" style="margin-top: 10px;"></div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">3. Select Lace Image</div>
            <div class="input-group">
                <div class="file-input-container">
                    <button type="button">Choose Lace (PNG)</button>
                    <input type="file" id="lace-input" accept=".png">
                </div>
                <div id="lace-name" style="margin-top: 10px;"></div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">4. Logo Position</div>
            <div class="position-buttons">
                <div class="position-button" data-position="top-left">Top Left</div>
                <div class="position-button" data-position="top-right">Top Right</div>
                <div class="position-button" data-position="bottom-left">Bottom Left</div>
                <div class="position-button" data-position="bottom-right">Bottom Right</div>
            </div>
            <div id="position-value" style="margin-top: 10px;">Selected Position: None</div>
        </div>
        
        <div class="section">
            <div class="section-title">5. Logo Size</div>
            <div class="slider-container">
                <input type="range" id="logo-size" min="1" max="5" value="3" style="width: 100%;">
                <div id="logo-size-value">Logo Size: 3</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">6. Lace Opacity</div>
            <div class="slider-container">
                <input type="range" id="lace-opacity" min="1" max="100" value="30" style="width: 100%;">
                <div id="lace-opacity-value">Lace Opacity: 30%</div>
            </div>
        </div>
        
        <div class="preview-container">
            <div class="section-title">Preview</div>
            <canvas id="preview-canvas"></canvas>
        </div>
        
        <button id="process-button" disabled>Process Images</button>
        
        <div class="progress-container">
            <div id="progress-text">Processing...</div>
            <progress id="progress-bar" value="0" max="100"></progress>
        </div>
        
        <div id="gallery"></div>
    </div>

    <script>
        // Global variables
        let selectedImages = [];
        let logoImage = null;
        let laceImage = null;
        let selectedPosition = null;
        let logoSize = 3;
        let laceOpacity = 30;
        let processedImages = [];

        // DOM Elements
        const imageInput = document.getElementById('image-input');
        const logoInput = document.getElementById('logo-input');
        const laceInput = document.getElementById('lace-input');
        const imageCountEl = document.getElementById('image-count');
        const logoNameEl = document.getElementById('logo-name');
        const laceNameEl = document.getElementById('lace-name');
        const positionButtons = document.querySelectorAll('.position-button');
        const positionValueEl = document.getElementById('position-value');
        const logoSizeSlider = document.getElementById('logo-size');
        const logoSizeValueEl = document.getElementById('logo-size-value');
        const laceOpacitySlider = document.getElementById('lace-opacity');
        const laceOpacityValueEl = document.getElementById('lace-opacity-value');
        const previewCanvas = document.getElementById('preview-canvas');
        const processButton = document.getElementById('process-button');
        const progressContainer = document.querySelector('.progress-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const gallery = document.getElementById('gallery');

        // Event Listeners
        imageInput.addEventListener('change', handleImageSelection);
        logoInput.addEventListener('change', handleLogoSelection);
        laceInput.addEventListener('change', handleLaceSelection);
        
        positionButtons.forEach(button => {
            button.addEventListener('click', () => {
                positionButtons.forEach(btn => btn.classList.remove('selected'));
                button.classList.add('selected');
                selectedPosition = button.getAttribute('data-position');
                
                let horizontalValue = 5;
                let verticalValue = 5;
                
                if (selectedPosition === 'top-right' || selectedPosition === 'bottom-right') {
                    horizontalValue = 80;
                }
                
                if (selectedPosition === 'bottom-left' || selectedPosition === 'bottom-right') {
                    verticalValue = 90;
                }
                
                positionValueEl.textContent = `Selected Position: ${selectedPosition} (${horizontalValue}, ${verticalValue})`;
                updatePreview();
                checkIfReadyToProcess();
            });
        });
        
        logoSizeSlider.addEventListener('input', () => {
            logoSize = parseInt(logoSizeSlider.value);
            logoSizeValueEl.textContent = `Logo Size: ${logoSize}`;
            updatePreview();
        });
        
        laceOpacitySlider.addEventListener('input', () => {
            laceOpacity = parseInt(laceOpacitySlider.value);
            laceOpacityValueEl.textContent = `Lace Opacity: ${laceOpacity}%`;
            updatePreview();
        });
        
        processButton.addEventListener('click', processImages);

        // Functions
        function handleImageSelection(e) {
            selectedImages = Array.from(e.target.files);
            imageCountEl.textContent = `Selected ${selectedImages.length} image(s)`;
            
            if (selectedImages.length > 0) {
                loadImageForPreview(selectedImages[0]);
            }
            
            checkIfReadyToProcess();
        }
        
        function handleLogoSelection(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                logoNameEl.textContent = `Selected: ${file.name}`;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        logoImage = img;
                        updatePreview();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            checkIfReadyToProcess();
        }
        
        function handleLaceSelection(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                laceNameEl.textContent = `Selected: ${file.name}`;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        laceImage = img;
                        updatePreview();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            checkIfReadyToProcess();
        }
        
        function loadImageForPreview(file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    updatePreview(img);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function updatePreview(mainImage) {
            if (!mainImage && (!selectedImages.length || !logoImage || !laceImage || !selectedPosition)) {
                previewCanvas.style.display = 'none';
                return;
            }
            
            if (!previewCanvas.getContext) {
                return; // Canvas not supported
            }
            
            if (mainImage) {
                previewCanvas.width = mainImage.width;
                previewCanvas.height = mainImage.height;
                previewCanvas.style.display = 'block';
                
                const ctx = previewCanvas.getContext('2d');
                ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
                
                // Draw main image
                ctx.drawImage(mainImage, 0, 0, previewCanvas.width, previewCanvas.height);
                
                // Draw logo if available
                if (logoImage && selectedPosition) {
                    const divisor = 7 - logoSize + 3; // Convert slider value to divisor 
                    const logoWidth = previewCanvas.width / divisor;
                    const logoHeight = (logoImage.height / logoImage.width) * logoWidth;
                    
                    let logoX = 0;
                    let logoY = 0;
                    
                    // Set position based on selected corner
                    if (selectedPosition === 'top-left') {
                        logoX = previewCanvas.width * 0.05;
                        logoY = previewCanvas.height * 0.05;
                    } else if (selectedPosition === 'top-right') {
                        logoX = (previewCanvas.width * 0.8) - (logoWidth / 2);
                        logoY = previewCanvas.height * 0.05;
                    } else if (selectedPosition === 'bottom-left') {
                        logoX = previewCanvas.width * 0.05;
                        logoY = (previewCanvas.height * 0.9) - (logoHeight / 4);
                    } else if (selectedPosition === 'bottom-right') {
                        logoX = (previewCanvas.width * 0.8) - (logoWidth / 2);
                        logoY = (previewCanvas.height * 0.9) - (logoHeight / 4);
                    }
                    
                    ctx.drawImage(logoImage, logoX, logoY, logoWidth, logoHeight);
                }
                
                // Draw lace if available
                if (laceImage) {
                    const laceWidth = previewCanvas.width;
                    const laceHeight = laceWidth / 11;
                    const laceY = previewCanvas.height * 0.75;
                    
                    ctx.globalAlpha = laceOpacity / 100;
                    ctx.drawImage(laceImage, 0, laceY, laceWidth, laceHeight);
                    ctx.globalAlpha = 1.0;
                }
            }
        }
        
        function checkIfReadyToProcess() {
            if (selectedImages.length > 0 && logoImage && laceImage && selectedPosition) {
                processButton.disabled = false;
            } else {
                processButton.disabled = true;
            }
        }
        
        function processImages() {
            if (selectedImages.length === 0 || !logoImage || !laceImage || !selectedPosition) {
                alert('Please complete all required inputs before processing');
                return;
            }
            
            processedImages = [];
            gallery.innerHTML = '';
            progressContainer.style.display = 'block';
            progressBar.value = 0;
            progressText.textContent = `Processing 0/${selectedImages.length} images...`;
            
            let processed = 0;
            
            // Process each image asynchronously
            selectedImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        const processedImageDataUrl = processImage(img);
                        processedImages.push({
                            name: file.name,
                            dataUrl: processedImageDataUrl
                        });
                        
                        processed++;
                        progressBar.value = (processed / selectedImages.length) * 100;
                        progressText.textContent = `Processing ${processed}/${selectedImages.length} images...`;
                        
                        // Add to gallery
                        addImageToGallery(processedImageDataUrl, file.name);
                        
                        // Check if all processing is complete
                        if (processed === selectedImages.length) {
                            progressText.textContent = `Completed processing ${selectedImages.length} images!`;
                        }
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        function processImage(mainImage) {
            const canvas = document.createElement('canvas');
            canvas.width = mainImage.width;
            canvas.height = mainImage.height;
            
            const ctx = canvas.getContext('2d');
            
            // Draw main image
            ctx.drawImage(mainImage, 0, 0, canvas.width, canvas.height);
            
            // Draw logo
            const divisor = 7 - logoSize + 3; // Convert slider value to divisor
            const logoWidth = canvas.width / divisor;
            const logoHeight = (logoImage.height / logoImage.width) * logoWidth;
            
            let logoX = 0;
            let logoY = 0;
            
            // Set position based on selected corner
            if (selectedPosition === 'top-left') {
                logoX = canvas.width * 0.05;
                logoY = canvas.height * 0.05;
            } else if (selectedPosition === 'top-right') {
                logoX = (canvas.width * 0.8) - (logoWidth / 2);
                logoY = canvas.height * 0.05;
            } else if (selectedPosition === 'bottom-left') {
                logoX = canvas.width * 0.05;
                logoY = (canvas.height * 0.9) - (logoHeight / 4);
            } else if (selectedPosition === 'bottom-right') {
                logoX = (canvas.width * 0.8) - (logoWidth / 2);
                logoY = (canvas.height * 0.9) - (logoHeight / 4);
            }
            
            ctx.drawImage(logoImage, logoX, logoY, logoWidth, logoHeight);
            
            // Draw lace with opacity
            const laceWidth = canvas.width;
            const laceHeight = laceWidth / 11;
            const laceY = canvas.height * 0.75;
            
            ctx.globalAlpha = laceOpacity / 100;
            ctx.drawImage(laceImage, 0, laceY, laceWidth, laceHeight);
            ctx.globalAlpha = 1.0;
            
            return canvas.toDataURL('image/jpeg');
        }
        
        function addImageToGallery(dataUrl, fileName) {
            const container = document.createElement('div');
            container.style.position = 'relative';
            
            const img = document.createElement('img');
            img.src = dataUrl;
            img.className = 'result-image';
            img.title = fileName;
            
            const downloadBtn = document.createElement('a');
            downloadBtn.href = dataUrl;
            downloadBtn.download = fileName.replace(/\.[^/.]+$/, "") + '_processed.jpg';
            downloadBtn.textContent = 'Download';
            downloadBtn.style.display = 'block';
            downloadBtn.style.marginTop = '5px';
            downloadBtn.style.textAlign = 'center';
            downloadBtn.style.backgroundColor = '#3498db';
            downloadBtn.style.color = 'white';
            downloadBtn.style.textDecoration = 'none';
            downloadBtn.style.padding = '5px';
            downloadBtn.style.borderRadius = '3px';
            
            container.appendChild(img);
            container.appendChild(downloadBtn);
            gallery.appendChild(container);
        }
    </script>
</body>
</html>
